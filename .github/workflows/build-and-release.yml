name: ğŸš€ Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¦ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
    
    - name: ğŸ“‹ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: ğŸ”¨ Build executable
      run: |
        pyinstaller --onefile --windowed --name "MeterGenerator" --icon=icon.ico meter_generator.py
    
    - name: ğŸ“¦ Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: MeterGenerator-Windows
        path: dist/MeterGenerator.exe
    
    - name: ğŸ‰ Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/MeterGenerator.exe
        generate_release_notes: true
        body: |
          ## ğŸ¯ Meter Data Generator Release
          
          ### ğŸ“¦ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ:
          - **MeterGenerator.exe** - Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ° Ğ´Ğ»Ñ Windows
          
          ### ğŸ”§ Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ– Ğ²Ğ¸Ğ¼Ğ¾Ğ³Ğ¸:
          - Windows 7/10/11
          - 50 MB Ğ²Ñ–Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¼Ñ–ÑÑ†Ñ
          
          ### ğŸš€ Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ:
          1. Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ñ‚Ğµ MeterGenerator.exe
          2. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ñƒ (Ğ²ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ½Ğµ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ğµ)
          3. ĞĞ°Ğ»Ğ°ÑˆÑ‚ÑƒĞ¹Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸ Ñ‚Ğ° Ğ·Ğ³ĞµĞ½ĞµÑ€ÑƒĞ¹Ñ‚Ğµ Ğ´Ğ°Ğ½Ñ–
          
          ### ğŸ“Š Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ—:
          - âš¡ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ Ğ´Ğ°Ğ½Ğ¸Ñ… 1-Ñ„Ğ°Ğ·Ğ½Ğ¸Ñ… Ñ‚Ğ° 3-Ñ„Ğ°Ğ·Ğ½Ğ¸Ñ… Ğ»Ñ–Ñ‡Ğ¸Ğ»ÑŒĞ½Ğ¸ĞºÑ–Ğ²
          - ğŸ“ˆ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğµ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Excel Ğ·Ğ²Ñ–Ñ‚Ñ–Ğ² Ğ· Ğ´Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ°Ğ¼Ğ¸
          - ğŸ¨ Ğ—Ñ€ÑƒÑ‡Ğ½Ğ¸Ğ¹ Ğ³Ñ€Ğ°Ñ„Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
          - ğŸ“‹ 1200 Ğ·Ğ°Ğ¿Ğ¸ÑÑ–Ğ² Ğ· Ñ€ĞµĞ°Ğ»Ñ–ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ğ¼Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑƒĞ³Ğ¸
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  build-cross-platform:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
        
    runs-on: ${{ matrix.os }}
    
    steps:
    - name: ğŸ“¦ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
    
    - name: ğŸ“‹ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
    
    - name: ğŸ”¨ Build executable
      run: |
        pyinstaller --onefile --windowed --name "MeterGenerator" meter_generator.py
    
    - name: ğŸ“¦ Upload artifact
      uses: actions/upload-artifact@v3
      with:
        name: MeterGenerator-${{ matrix.os }}
        path: dist/MeterGenerator*